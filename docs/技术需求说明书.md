# 短期冲刺管理App技术需求说明书

## 1. 项目概述

### 1.1 产品定位
短期冲刺管理工具，专注于短期目标的快速达成，支持学习冲刺和简单项目管理。面向追求快速见效、不愿长期投入的用户群体。

### 1.2 核心特性
- **短期导向**：最长支持90天（一个季度）的计划
- **双重用途**：学习冲刺 + 简单项目管理
- **AI辅助**：内置Gemini AI智能生成计划
- **个人专用**：无社交功能，专注个人效率
- **快速见效**：强调立即行动和快速反馈

### 1.3 目标用户
- 需要短期技能提升的职场人士
- 准备考试/面试的学习者
- 个人项目开发者
- 习惯养成需求者

## 2. 功能需求

### 2.1 核心功能模块

#### 2.1.1 冲刺计划系统
**预设冲刺模板（固定5种，不支持自定义）：**
- 7天短期冲刺
- 21天习惯养成
- 30天项目冲刺
- 60天项目冲刺
- 90天季度目标

**计划特性：**
- 强制时间上限（最长90天）
- 明确的开始和结束日期
- 倒计时显示营造紧迫感
- 模板固定，确保用户专注执行而非纠结选择

#### 2.1.2 双模式任务管理
**学习模式：**
- 每日学习任务
- 学习时间记录
- 知识点掌握度跟踪
- 学习资料管理

**项目模式：**
- 简单看板（待办/进行中/已完成）
- 里程碑设置和跟踪
- 项目资源管理（文件、链接、笔记）
- Obsidian集成：构建项目知识图谱
- 简单的时间跟踪

#### 2.1.3 AI智能计划生成
**功能描述：**
- 内置Gemini AI助手（服务方提供API密钥）
- 用户无需提供API密钥，直接使用
- 对话式需求收集
- 智能生成结构化计划
- 一键导入为冲刺计划

**使用限制（按用户等级）：**
- 普通用户：每天5次AI交流
- 高级用户：每天10次AI交流
- 管理员：无限制使用

**交互流程：**
1. 用户描述学习/项目目标
2. AI引导式收集详细需求
3. 生成标准化JSON格式计划
4. 用户预览、编辑、确认
5. 一键导入到个人计划中

#### 2.1.4 冲刺执行工具
- 每日冲刺：今日必做任务清单
- 番茄钟集成：专注时间管理
- 快速记录：学习笔记、项目进展
- 即时调整：根据进展快速调整计划

#### 2.1.5 进度可视化
- 倒计时显示：距离目标截止的剩余时间
- 完成度仪表盘：直观显示整体进度
- 每日进度条：当日任务完成情况
- 冲刺热力图：显示每日活跃度

#### 2.1.6 提醒系统
**提醒类型：**
- 时间类：每日冲刺、截止日期、休息、复盘提醒
- 进度类：进度落后、连续未完成、里程碑达成、习惯中断提醒

**实现方式：**
- Web Push Notifications（浏览器推送）
- Firebase Cloud Messaging（FCM）
- 应用内提醒（红点、弹窗、倒计时）
- PWA通知支持

#### 2.1.7 冲刺复盘系统
- 阶段性回顾：每周快速回顾和调整
- 冲刺总结：冲刺结束后的成果总结
- 经验提取：记录成功经验和改进点
- 下次冲刺建议：基于本次经验的改进建议

#### 2.1.8 个人激励机制
- 连续冲刺天数：保持连续执行的记录
- 冲刺完成率：历史冲刺的成功率统计
- 个人最佳：最长连续天数、最高完成率等
- 冲刺徽章：完成不同类型冲刺的标记

### 2.2 用户认证和权限系统

#### 2.2.1 用户注册和登录

**注册方式：**

- 开放用户注册
- 仅支持邮箱密码注册/登录
- 邮箱验证确保账户安全

#### 2.2.2 用户等级系统

**用户类型：**

- **普通用户**：默认注册用户
  - AI交流限制：每天5次
  - 基础功能完整访问
- **高级用户**：付费升级用户
  - AI交流限制：每天10次
  - 所有功能完整访问
- **管理员**：系统管理员
  - AI交流：无限制
  - 系统管理权限

#### 2.2.3 数据隔离

- 每个用户独立的数据空间
- 使用Firebase Auth的用户ID作为数据分区键
- Firestore安全规则确保数据隔离

### 2.3 Obsidian集成功能

#### 2.3.1 知识图谱构建

**功能描述：**

- 与Obsidian笔记软件集成
- 自动构建项目知识图谱
- 支持双向链接和标签系统
- 可视化知识网络关系

**集成方式：**

- Obsidian插件开发
- 通过Obsidian API同步数据
- 支持Markdown格式导入导出
- 实时同步项目进展到Obsidian

**知识管理功能：**

- 项目笔记自动分类
- 学习资料关联链接
- 进度节点知识沉淀
- 经验总结知识库构建

## 3. 技术架构

### 3.1 技术栈选择

#### 3.1.1 前端技术栈
```
框架：Next.js 14 + TypeScript
UI组件：Tailwind CSS + Headless UI
状态管理：Zustand
PWA支持：Next.js PWA插件
图表库：Chart.js 或 Recharts
```

#### 3.1.2 后端技术栈
```
部署平台：Firebase App Hosting
认证系统：Firebase Auth
数据库：Firestore
推送服务：Firebase Cloud Messaging (FCM)
AI服务：Google Gemini API
云函数：Firebase Cloud Functions（定时任务）
```

### 3.2 系统架构设计

#### 3.2.1 整体架构
```
用户 → Firebase App Hosting (Next.js) → Firebase Services
                ↓
    ┌─────────────────────────────────────┐
    │  Firebase Auth (用户认证)            │
    │  Firestore (数据存储)               │
    │  Cloud Functions (定时任务)         │
    │  Cloud Messaging (推送通知)         │
    │  Gemini API (AI计划生成)            │
    └─────────────────────────────────────┘
```

#### 3.2.2 数据库设计

```
/users/{userId}/
  ├── profile/           # 用户基本信息
  │   ├── userType       # 用户等级（normal/premium/admin）
  │   ├── aiUsageCount   # AI使用次数统计
  │   └── lastResetDate  # 使用次数重置日期
  ├── sprints/          # 冲刺计划
  │   ├── {sprintId}/
  │   │   ├── info       # 计划基本信息
  │   │   ├── phases/    # 阶段数据
  │   │   └── tasks/     # 任务数据
  ├── settings/         # 个人设置
  │   ├── notifications  # 提醒设置
  │   ├── preferences   # 用户偏好
  │   └── obsidian      # Obsidian集成设置
  ├── ai_history/       # AI对话历史
  └── knowledge_graph/  # Obsidian知识图谱数据
```

### 3.3 AI功能技术实现

#### 3.3.1 Gemini API集成

```typescript
// Next.js API路由：/api/ai/generate-plan.ts
- 服务方提供API密钥，用户无需配置
- 用户等级验证和使用次数限制
- 提示词工程和模板管理
- 响应格式验证和处理
- 错误处理和重试机制
- 使用次数统计和重置机制
```

#### 3.3.2 用户等级和限制管理

```typescript
// 使用次数检查和限制
interface AIUsageLimit {
  normal: 5,      // 普通用户每日5次
  premium: 10,    // 高级用户每日10次
  admin: -1       // 管理员无限制
}

// 每日重置机制
- 每日0点重置使用次数
- Cloud Functions定时任务
- 用户等级验证中间件
```

#### 3.3.3 标准化输出格式
```json
{
  "sprintInfo": {
    "title": "计划标题",
    "duration": 30,
    "type": "learning|project",
    "description": "计划描述",
    "difficulty": "beginner|intermediate|advanced"
  },
  "phases": [...],
  "milestones": [...],
  "tips": [...]
}
```

### 3.4 Obsidian集成技术实现

#### 3.4.1 插件开发

```typescript
// Obsidian插件开发
- 使用Obsidian Plugin API
- 支持双向数据同步
- Markdown格式处理
- 知识图谱可视化
```

#### 3.4.2 数据同步机制

```typescript
// 实时同步策略
- WebSocket连接保持
- 增量数据同步
- 冲突解决机制
- 离线数据缓存
```

### 3.5 推送通知技术实现

#### 3.5.1 Web Push实现

```typescript
// Service Worker注册
// 推送订阅管理
// 通知权限请求
// FCM集成
```

#### 3.5.2 定时任务

```typescript
// Cloud Functions定时检查
// 批量推送处理
// 通知状态管理
// 用户偏好过滤
```

## 4. 非功能性需求

### 4.1 性能要求
- 首屏加载时间 < 3秒
- 页面切换响应时间 < 500ms
- AI计划生成响应时间 < 30秒
- 支持离线基本功能使用

### 4.2 安全要求

- Firebase Auth用户认证
- Firestore安全规则数据隔离
- API密钥服务端保护（用户无需提供）
- HTTPS强制加密
- 用户等级权限验证
- AI使用次数防刷机制

### 4.3 兼容性要求
- 现代浏览器支持（Chrome 90+, Firefox 88+, Safari 14+）
- 桌面端优先设计
- PWA支持，可安装到桌面
- 响应式设计适配不同屏幕尺寸

### 4.4 可用性要求
- 直观的用户界面设计
- 快速上手，学习成本低
- 支持键盘快捷键操作
- 无障碍访问支持

## 5. 开发计划

### 5.1 开发阶段

1. **基础架构搭建**（1-2周）
2. **用户认证和权限系统**（1-2周）
3. **核心功能开发**（3-4周）
4. **AI功能集成和限制管理**（2-3周）
5. **Obsidian集成开发**（2-3周）
6. **推送通知系统**（1-2周）
7. **测试和优化**（2周）

### 5.2 技术风险评估

- Gemini API稳定性和响应时间
- Obsidian插件开发复杂度
- Web Push兼容性问题
- Firebase配额和成本控制
- AI生成内容质量保证
- 用户等级管理复杂性

## 6. 部署和运维

### 6.1 部署方案
- Firebase App Hosting自动部署
- 环境变量配置管理
- 版本控制和回滚策略

### 6.2 监控和日志

- Firebase Analytics用户行为分析
- 错误监控和报警
- 性能监控和优化
- AI使用情况统计
- 用户等级转换跟踪
- Obsidian集成使用统计

---

**文档版本：** v1.0  
**创建日期：** 2025-08-16  
**最后更新：** 2025-08-16
